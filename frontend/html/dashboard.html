<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard | SnackCity</title>
  <link rel="stylesheet" href="../css/styles.css">
  <script type="module" src="/js/user-session.mjs" defer></script>
</head>
<body class="app-page">
  <header class="app-header">
    <div class="container">
      <h1 id="userName">Usuario</h1>
      <div class="user-meta">
        <span class="user-role" id="userRole">Rol</span>
        <span class="user-department" id="userDept">Departamento</span>
      </div>
      <button id="logout" class="btn btn-secondary">Cerrar sesión</button>
    </div>
  </header>

  <main class="container">
    <h2>Dashboard</h2>
    <p>Bienvenido al dashboard. Aquí se agregará la interfaz principal según el rol/permiso.</p>

    <section id="stats" class="card">
      <h3>Estadísticas</h3>
      <p>Placeholder para métricas y tablas.</p>
    </section>
  </main>

  <script type="module">
    import { requireAuth } from '/js/user-session.mjs';
    import { getAuth, signOut } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';

    document.addEventListener('DOMContentLoaded', async () => {
      const profile = await requireAuth('/index.html');
      if (!profile) return;

      // quick populate of header fields (already handled by user-session.mjs but keep fallback)
      document.getElementById('userName').textContent = profile.nombre || profile.correo || '-';
      document.getElementById('userRole').textContent = profile.rol || '-';
      document.getElementById('userDept').textContent = profile.departamento || profile.sucursal || '-';

      document.getElementById('logout').addEventListener('click', async () => {
        try {
          await signOut(getAuth());
          window.location.href = '/index.html';
        } catch (err) {
          console.error('Error signOut', err);
        }
      });
    });
  </script>
</body>
</html>
